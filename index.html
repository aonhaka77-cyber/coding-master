<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë”© ë§ˆìŠ¤í„° - ì–¼í‹°ë°‹ ì—ë””ì…˜</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #4f46e5; --bg: #f3f4f6; --text: #1f2937; --danger: #ef4444; --card: #ffffff; --tag: #dbeafe; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background: var(--bg); color: var(--text); }
        
        header { background: white; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .header-top { max-width: 1200px; margin: 0 auto; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 900; color: var(--primary); cursor: pointer; }
        
        .nav-menu { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; gap: 15px; overflow-x: auto; border-top: 1px solid #f3f4f6; }
        .nav-item { padding: 12px 5px; cursor: pointer; font-size: 14px; font-weight: 700; color: #6b7280; white-space: nowrap; border-bottom: 3px solid transparent; }
        .nav-item.active { color: var(--primary); border-bottom-color: var(--primary); }

        .main-container { max-width: 1200px; margin: 20px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        @media (max-width: 900px) { .main-container { grid-template-columns: 1fr; } }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 15px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; transition: 0.2s; font-size: 13px; }
        .btn-p { background: var(--primary); color: white; }
        .btn-s { background: #f3f4f6; color: #4b5563; }
        .btn-active { background: #fee2e2; color: var(--danger); } /* ì¢‹ì•„ìš” ì·¨ì†Œ ìƒíƒœ */

        .item-row { padding: 15px; border-bottom: 1px solid #f3f4f6; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .item-row:hover { background: #f9fafb; }
        .tag { display: inline-block; padding: 2px 8px; background: var(--tag); color: #1e40af; border-radius: 5px; font-size: 11px; margin-right: 4px; }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center; }
        .modal.active { display: flex; }
        .modal-content { background:white; padding:25px; border-radius:15px; width:90%; max-width:450px; }
        input, textarea { width:100%; padding:10px; margin-top:10px; border:1px solid #ddd; border-radius:8px; }

        .noti-badge { position: relative; cursor: pointer; margin-right: 15px; }
        .badge { position: absolute; top:-5px; right:-5px; background: red; color: white; font-size: 10px; padding: 2px 5px; border-radius: 10px; }
        .admin-badge { background: #000; color: gold; padding: 2px 5px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="logo" onclick="goHome()">ğŸš€ MASTER PIECE</div>
        <div style="display:flex; align-items:center;">
            <div class="noti-badge" onclick="toggleNoti()">ğŸ””<span id="notiCount" class="badge" style="display:none;">0</span></div>
            <div id="authArea"><button class="btn btn-s" onclick="openModal('loginModal')">ë¡œê·¸ì¸</button></div>
            <div id="userArea" style="display:none; align-items:center; gap:10px;">
                <span id="welcomeMsg" style="font-weight:bold; cursor:pointer;" onclick="showPage('mypage')"></span>
                <button class="btn btn-s" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </div>
    <nav class="nav-menu">
        <div class="nav-item active" id="menu-home" onclick="goHome()">í™ˆ</div>
        <div class="nav-item" id="menu-notice" onclick="showBoard('notice')">ğŸ“¢ ê³µì§€</div>
        <div class="nav-item" id="menu-free" onclick="showBoard('free')">ììœ </div>
        <div class="nav-item" id="menu-qna" onclick="showBoard('qna')">Q&A</div>
        <div class="nav-item" id="menu-inquiry" onclick="showPage('inquiry')">ë¬¸ì˜</div>
        <div class="nav-item" id="menu-mypage" onclick="showPage('mypage')">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</div>
        <div class="nav-item" id="menu-admin" onclick="showPage('admin')" style="display:none; color:var(--danger)">ğŸ‘‘ ê´€ë¦¬</div>
    </nav>
</header>

<div class="main-container">
    <div class="content-left">
        <div id="page-home" class="page active">
            <div class="card" style="background: var(--primary); color:white;">
                <h2>ì–´ì„œì˜¤ì„¸ìš”, ë§ˆìŠ¤í„° ì—ë””ì…˜!</h2>
                <p>ì¢‹ì•„ìš” ì·¨ì†Œ ê¸°ëŠ¥ê³¼ ë§ˆì´í˜ì´ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="card"><h3>ğŸ”¥ ì¸ê¸° ê²Œì‹œê¸€</h3><div id="home-posts"></div></div>
        </div>

        <div id="page-board" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 id="board-title">ê²Œì‹œíŒ</h2>
                <button class="btn btn-p" onclick="openWriteModal()">ê¸€ì“°ê¸°</button>
            </div>
            <div id="post-list" class="card" style="padding:0;"></div>
        </div>

        <div id="page-detail" class="page">
            <div class="card">
                <h1 id="det-title"></h1>
                <p id="det-info" style="color:#888; font-size:13px; margin:5px 0;"></p>
                <div id="det-tags" style="margin-bottom:15px;"></div>
                <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
                <div id="det-body" style="line-height:1.7; min-height:150px; white-space:pre-wrap;"></div>
                <div style="margin-top:20px; display:flex; gap:10px;">
                    <button class="btn" id="likeBtn" onclick="handleLikeToggle()">â¤ï¸ ì¢‹ì•„ìš” <span id="like-count">0</span></button>
                    <button class="btn btn-s" id="delBtn" style="display:none;" onclick="deletePost()">ì‚­ì œ</button>
                </div>
            </div>
            <div class="card">
                <h4>ëŒ“ê¸€ <span id="comm-count">0</span></h4>
                <div id="comm-list" style="margin:15px 0;"></div>
                <div style="display:flex; gap:10px;"><input type="text" id="commInp" placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."><button class="btn btn-p" onclick="saveComment()">ë“±ë¡</button></div>
            </div>
        </div>

        <div id="page-mypage" class="page">
            <div class="card">
                <h2 id="my-name">ë§ˆì´í˜ì´ì§€</h2>
                <p style="color:#666;">ë‚´ í™œë™ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>
            <div class="card">
                <h3>ğŸ“ ë‚´ê°€ ì“´ ê¸€</h3>
                <div id="my-posts"></div>
            </div>
            <div class="card">
                <h3>ğŸ’– ì¢‹ì•„ìš” í•œ ê¸€</h3>
                <div id="my-likes"></div>
            </div>
        </div>

        <div id="page-inquiry" class="page">
            <div class="card">
                <h2>ğŸ“® ìš´ì˜ìì—ê²Œ ë¬¸ì˜</h2>
                <textarea id="inqInp" rows="4" placeholder="ë¬¸ì˜ ì‚¬í•­ì„ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
                <button class="btn btn-p" style="width:100%; margin-top:10px;" onclick="sendInquiry()">ë¬¸ì˜í•˜ê¸°</button>
            </div>
            <div id="my-inquiry-list"></div>
        </div>

        <div id="page-admin" class="page">
            <div class="card">
                <h2>ğŸ‘‘ ì „ì²´ íšŒì› ê´€ë¦¬ (ìš´ì˜ì ì„¤ì •)</h2>
                <div id="user-list-admin" style="margin-top:15px;"></div>
            </div>
            <div class="card">
                <h2>ğŸ’¬ ìœ ì € ë¬¸ì˜ ë‹µë³€</h2>
                <div id="admin-inq-list"></div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <h4>ğŸ“Š ì‹¤ì‹œê°„ í†µê³„</h4>
            <div id="stats" style="font-size:13px; margin-top:10px;">ê¸€: 0 | ìœ ì €: 0</div>
        </div>
    </div>
</div>

<div id="notiBox" class="card" style="display:none; position:fixed; top:60px; right:20px; width:280px; z-index:3000; border:1px solid #ddd; max-height:300px; overflow-y:auto;">
    <div style="display:flex; justify-content:space-between;"><b>ì•Œë¦¼</b><button onclick="clearNoti()" style="border:0; background:none; cursor:pointer; font-size:11px; color:blue;">ëª¨ë‘ ì½ìŒ</button></div>
    <div id="notiList" style="font-size:13px; margin-top:10px;"></div>
</div>

<div class="modal" id="loginModal"><div class="modal-content"><h2>ë¡œê·¸ì¸</h2><input type="text" id="l-id" placeholder="ì•„ì´ë””"><input type="password" id="l-pw" placeholder="ë¹„ë°€ë²ˆí˜¸"><button class="btn btn-p" style="width:100%; margin-top:15px;" onclick="handleLogin()">ë¡œê·¸ì¸</button><button class="btn btn-s" style="width:100%; margin-top:5px;" onclick="handleJoin()">íšŒì›ê°€ì…</button></div></div>
<div class="modal" id="writeModal"><div class="modal-content"><h2>ê¸€ì“°ê¸°</h2><input type="text" id="w-title" placeholder="ì œëª©"><input type="text" id="w-tag" placeholder="íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)"><textarea id="w-content" rows="10" placeholder="ë‚´ìš©"></textarea><button class="btn btn-p" style="width:100%; margin-top:15px;" onclick="savePost()">ì‘ì„± ì™„ë£Œ</button><button class="btn btn-s" style="width:100%; margin-top:5px;" onclick="closeModal('writeModal')">ë‹«ê¸°</button></div></div>

<script>
    // 1. Firebase ì´ˆê¸°í™”
    const firebaseConfig = {
        apiKey: "AIzaSyBcxvsiEOyL1lZGVr1UE2gzzZ7HQX5YfbI",
        authDomain: "code-78890.firebaseapp.com",
        projectId: "code-78890",
        storageBucket: "code-78890.firebasestorage.app",
        messagingSenderId: "30317586652",
        appId: "1:30317586652:web:d1e6fa39c319029fb7ac19"
    };
    firebase.initializeApp(firebaseConfig);
    const fdb = firebase.firestore();

    let db = { users:[], posts:[], currentBoard:'free', currentUser:null, viewingId:null };

    // 2. ì´ˆê¸° ê¸°ë™ & ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
    function init() {
        // ìœ ì € ì •ë³´ (ì‹¤ì‹œê°„)
        fdb.collection("users").onSnapshot(s => {
            db.users = s.docs.map(d => ({fId: d.id, ...d.data()}));
            updateStats();
            if(db.currentUser) {
                const updated = db.users.find(u => u.id === db.currentUser.id);
                if(updated) { db.currentUser = updated; updateAuthUI(); }
            }
            if(document.getElementById('page-admin').classList.contains('active')) renderAdminUsers();
        });

        // ê²Œì‹œê¸€ ì •ë³´ (ì‹¤ì‹œê°„)
        fdb.collection("posts").orderBy("id", "desc").onSnapshot(s => {
            db.posts = s.docs.map(d => ({fId: d.id, ...d.data()}));
            renderPostList(); renderHome(); updateStats();
            if(db.viewingId) renderDetail(db.viewingId); // ì¢‹ì•„ìš” ì‹¤ì‹œê°„ ë°˜ì˜ìš©
            if(document.getElementById('page-mypage').classList.contains('active')) renderMyPage();
        });

        setupInquiryListener();
        setupNotiListener();
    }

    // 3. ì•Œë¦¼ ë° ë¬¸ì˜ ë¦¬ìŠ¤ë„ˆ
    function setupNotiListener() {
        if(!db.currentUser) return;
        fdb.collection("notis").where("to","==",db.currentUser.id).where("read","==",false).onSnapshot(s => {
            const list = s.docs.map(d => ({fId: d.id, ...d.data()}));
            document.getElementById('notiCount').innerText = list.length;
            document.getElementById('notiCount').style.display = list.length > 0 ? 'block' : 'none';
            document.getElementById('notiList').innerHTML = list.map(n => `<div style="padding:8px; border-bottom:1px solid #eee;">${n.msg}</div>`).join('') || 'ìƒˆ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.';
        });
    }

    function setupInquiryListener() {
        fdb.collection("inq").orderBy("date","desc").onSnapshot(s => {
            const all = s.docs.map(d => ({fId: d.id, ...d.data()}));
            // ìœ ì €ìš©
            if(db.currentUser) {
                const mine = all.filter(i => i.user === db.currentUser.id);
                document.getElementById('my-inquiry-list').innerHTML = mine.map(i => `
                    <div class="card">Q: ${i.content} <br> ${i.reply ? `<div style="background:#f0fdf4; padding:10px; margin-top:10px; border-radius:8px;">A: ${i.reply}</div>` : `<small style="color:orange;">ë‹µë³€ ëŒ€ê¸°ì¤‘</small>`}</div>
                `).join('');
            }
            // ê´€ë¦¬ììš©
            if(db.currentUser && db.currentUser.role === 'admin') {
                document.getElementById('admin-inq-list').innerHTML = all.map(i => `
                    <div class="card"><b>${i.user}</b>: ${i.content}<br>
                        ${i.reply ? `ë‹µë³€ì™„ë£Œ: ${i.reply}` : `<input id="rep-${i.fId}"><button onclick="replyInq('${i.fId}')">ë‹µë³€</button>`}
                    </div>
                `).join('');
            }
        });
    }

    // 4. ë¡œê·¸ì¸ & ìš´ì˜ì ê¶Œí•œ
    async function handleLogin() {
        const id = document.getElementById('l-id').value.trim();
        const pw = document.getElementById('l-pw').value.trim();
        // ê³„ì†ë°˜ë³µ ë§ˆìŠ¤í„° ê³ ì •
        if(id === 'ê³„ì†ë°˜ë³µ' && pw === 'akdhs') {
            db.currentUser = { id:'ê³„ì†ë°˜ë³µ', role:'admin' };
        } else {
            const u = db.users.find(u => u.id === id && u.pw === pw);
            if(!u) return alert('ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            db.currentUser = u;
        }
        updateAuthUI(); closeModal('loginModal'); setupNotiListener(); setupInquiryListener();
    }

    async function handleJoin() {
        const id = document.getElementById('l-id').value.trim();
        const pw = document.getElementById('l-pw').value.trim();
        if(db.users.find(u=>u.id === id)) return alert('ì´ë¯¸ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
        await fdb.collection("users").add({ id, pw, role: 'member' });
        alert('ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
    }

    function updateAuthUI() {
        const isL = !!db.currentUser;
        document.getElementById('authArea').style.display = isL ? 'none' : 'block';
        document.getElementById('userArea').style.display = isL ? 'flex' : 'none';
        if(isL) {
            document.getElementById('welcomeMsg').innerHTML = db.currentUser.id + (db.currentUser.role === 'admin' ? '<span class="admin-badge">ADMIN</span>' : '');
            document.getElementById('menu-admin').style.display = (db.currentUser.role === 'admin') ? 'block' : 'none';
        }
    }

    function logout() { db.currentUser = null; updateAuthUI(); goHome(); }

    // 5. ê²Œì‹œíŒ ë¡œì§
    function showBoard(b) { db.currentBoard = b; showPage('board'); document.getElementById('board-title').innerText = b.toUpperCase(); renderPostList(); }
    function goHome() { showPage('home'); }
    function showPage(p) { 
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(document.getElementById('menu-'+p)) document.getElementById('menu-'+p).classList.add('active');
        if(p === 'mypage') renderMyPage();
        if(p === 'admin') renderAdminUsers();
    }

    function postItem(p) {
        return `<div class="item-row" onclick="viewPost('${p.fId}')">
            <div><b>${p.title}</b><br>${(p.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join('')}<br><small>${p.author}</small></div>
            <div style="text-align:right;"><b style="color:var(--danger)">â¤ï¸ ${p.likes||0}</b></div>
        </div>`;
    }

    function renderPostList() {
        const list = db.posts.filter(p => p.board === db.currentBoard);
        document.getElementById('post-list').innerHTML = list.map(p => postItem(p)).join('') || '<p style="padding:20px;">ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    }

    function renderHome() {
        const hot = [...db.posts].sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,5);
        document.getElementById('home-posts').innerHTML = hot.map(p => postItem(p)).join('');
    }

    // 6. ìƒì„¸ & ì¢‹ì•„ìš” í† ê¸€ (ì¤‘ìš”!)
    async function viewPost(fId) {
        db.viewingId = fId;
        showPage('detail');
        renderDetail(fId);
    }

    function renderDetail(fId) {
        const p = db.posts.find(x => x.fId === fId);
        if(!p) return;
        document.getElementById('det-title').innerText = p.title;
        document.getElementById('det-info').innerText = `${p.author} | ${p.date} | ì¡°íšŒ ${p.views||0}`;
        document.getElementById('det-tags').innerHTML = (p.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join('');
        document.getElementById('det-body').innerText = p.content;
        document.getElementById('like-count').innerText = p.likes || 0;
        
        // ì¢‹ì•„ìš” ë²„íŠ¼ ìƒíƒœ UI
        const isLiked = db.currentUser && p.likedBy && p.likedBy.includes(db.currentUser.id);
        const lBtn = document.getElementById('likeBtn');
        lBtn.className = isLiked ? 'btn btn-active' : 'btn btn-s';

        document.getElementById('delBtn').style.display = (db.currentUser && (db.currentUser.id === p.author || db.currentUser.role === 'admin')) ? 'block' : 'none';
        loadComments(fId);
    }

    async function handleLikeToggle() {
        if(!db.currentUser) return alert('ë¡œê·¸ì¸ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        const p = db.posts.find(x => x.fId === db.viewingId);
        const isLiked = p.likedBy && p.likedBy.includes(db.currentUser.id);
        
        const docRef = fdb.collection("posts").doc(db.viewingId);
        if(isLiked) {
            // ì·¨ì†Œ
            await docRef.update({
                likes: firebase.firestore.FieldValue.increment(-1),
                likedBy: firebase.firestore.FieldValue.arrayRemove(db.currentUser.id)
            });
        } else {
            // ì¢‹ì•„ìš”
            await docRef.update({
                likes: firebase.firestore.FieldValue.increment(1),
                likedBy: firebase.firestore.FieldValue.arrayUnion(db.currentUser.id)
            });
        }
    }

    // 7. ë§ˆì´í˜ì´ì§€ ë Œë”ë§
    function renderMyPage() {
        if(!db.currentUser) {
            document.getElementById('my-posts').innerHTML = 'ë¡œê·¸ì¸ í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            return;
        }
        document.getElementById('my-name').innerText = db.currentUser.id + "ë‹˜ì˜ ë§ˆì´í˜ì´ì§€";
        const myP = db.posts.filter(p => p.author === db.currentUser.id);
        const myL = db.posts.filter(p => p.likedBy && p.likedBy.includes(db.currentUser.id));
        
        document.getElementById('my-posts').innerHTML = myP.map(p => postItem(p)).join('') || 'ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
        document.getElementById('my-likes').innerHTML = myL.map(p => postItem(p)).join('') || 'ì¢‹ì•„ìš” í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.';
    }

    // 8. ê´€ë¦¬ì: ìš´ì˜ì ê¶Œí•œ ì„¤ì •
    function renderAdminUsers() {
        const masterId = 'ê³„ì†ë°˜ë³µ';
        document.getElementById('user-list-admin').innerHTML = db.users.map(u => `
            <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <span>${u.id} (${u.role})</span>
                ${(db.currentUser.id === masterId && u.id !== masterId) ? 
                    `<button class="btn btn-s" onclick="toggleAdmin('${u.fId}', '${u.role}')">${u.role === 'admin' ? 'ìš´ì˜ì í•´ì„' : 'ìš´ì˜ì ì„ëª…'}</button>` : ''}
            </div>
        `).join('');
    }

    async function toggleAdmin(fId, currentRole) {
        const nextRole = currentRole === 'admin' ? 'member' : 'admin';
        if(confirm(`${nextRole}ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            await fdb.collection("users").doc(fId).update({ role: nextRole });
        }
    }

    // ê¸°íƒ€ í•„ìˆ˜ í•¨ìˆ˜ë“¤
    async function saveComment() {
        const text = document.getElementById('commInp').value;
        const post = db.posts.find(p => p.fId === db.viewingId);
        await fdb.collection("comments").add({ postId: db.viewingId, user: db.currentUser.id, text, date: new Date().toLocaleString() });
        if(post.author !== db.currentUser.id) {
            await fdb.collection("notis").add({ to: post.author, msg: `[ëŒ“ê¸€ ì•Œë¦¼] ${text.substring(0,10)}...`, read: false });
        }
        document.getElementById('commInp').value = '';
    }

    async function loadComments(postId) {
        const s = await fdb.collection("comments").where("postId","==",postId).get();
        const list = s.docs.map(d => d.data());
        document.getElementById('comm-count').innerText = list.length;
        document.getElementById('comm-list').innerHTML = list.map(c => `<div style="padding:10px; background:#f9fafb; margin-bottom:5px; border-radius:8px; font-size:13px;"><b>${c.user}</b>: ${c.text}</div>`).join('');
    }

    async function sendInquiry() {
        const content = document.getElementById('inqInp').value;
        await fdb.collection("inq").add({ user: db.currentUser.id, content, date: new Date(), reply: null });
        alert('ë¬¸ì˜ ì ‘ìˆ˜!'); document.getElementById('inqInp').value = '';
    }

    async function replyInq(fId) {
        const reply = document.getElementById('rep-'+fId).value;
        await fdb.collection("inq").doc(fId).update({ reply });
    }

    function savePost() {
        if(db.currentBoard === 'notice' && db.currentUser.role !== 'admin') return alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        const title = document.getElementById('w-title').value;
        const tags = document.getElementById('w-tag').value.split(',').map(t=>t.trim());
        const content = document.getElementById('w-content').value;
        fdb.collection("posts").add({ 
            id: Date.now(), board: db.currentBoard, title, content, tags, 
            author: db.currentUser.id, date: new Date().toLocaleDateString(), likes:0, views:0, likedBy: [] 
        });
        closeModal('writeModal');
    }

    function updateStats() { document.getElementById('stats').innerText = `ê¸€: ${db.posts.length} | ìœ ì €: ${db.users.length}`; }
    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function openWriteModal() { if(!db.currentUser) return alert('ë¡œê·¸ì¸í•˜ì„¸ìš”.'); openModal('writeModal'); }
    function toggleNoti() { const b = document.getElementById('notiBox'); b.style.display = b.style.display==='none'?'block':'none'; }
    async function clearNoti() {
        const s = await fdb.collection("notis").where("to","==",db.currentUser.id).get();
        s.forEach(doc => doc.ref.update({ read: true }));
    }
    async function deletePost() { if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { await fdb.collection("posts").doc(db.viewingId).delete(); goHome(); } }

    window.onload = init;
</script>
</body>
</html>
