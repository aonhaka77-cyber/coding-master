<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë”© ë§ˆìŠ¤í„°</title>
    <style>
        /* --- ë””ìì¸ ì‹œìŠ¤í…œ --- */
        :root { --primary: #667eea; --secondary: #764ba2; --bg: #f8f9fa; --text: #222; --danger: #e74c3c; --accent: #f39c12; --card-bg: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; overflow-y: scroll; }
        
        /* í—¤ë” & ë„¤ë¹„ê²Œì´ì…˜ */
        header { background: white; border-bottom: 1px solid #e5e5e5; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header-top { max-width: 1200px; margin: 0 auto; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; gap: 15px; }
        .logo { font-size: 22px; font-weight: 900; color: var(--primary); cursor: pointer; letter-spacing: -1px; }
        .search-bar { flex: 1; max-width: 400px; }
        .search-bar input { width: 100%; padding: 10px 18px; border-radius: 25px; border: 1px solid #ddd; background: #f1f3f5; font-size: 14px; transition: 0.3s; }
        .search-bar input:focus { background: white; border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }

        .nav-menu { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; gap: 25px; overflow-x: auto; }
        .nav-item { padding: 15px 5px; cursor: pointer; font-size: 14px; font-weight: 700; color: #777; border-bottom: 3px solid transparent; white-space: nowrap; transition: 0.2s; }
        .nav-item:hover { color: var(--primary); }
        .nav-item.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container { max-width: 1200px; margin: 25px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 320px; gap: 25px; }
        @media (max-width: 950px) { .main-container { grid-template-columns: 1fr; } }

        .page { display: none; min-height: 600px; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); border-radius: 16px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #eee; }
        
        /* ê´‘ê³  ë°°ë„ˆ */
        .ad-banner { background: linear-gradient(135deg, #222, #444); color: white; border-radius: 16px; padding: 40px; margin-bottom: 25px; position: relative; overflow: hidden; }
        .ad-item h2 { font-size: 24px; margin-bottom: 10px; }
        .ad-item p { opacity: 0.8; font-size: 15px; }

        /* ë²„íŠ¼ */
        .btn { padding: 11px 22px; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 14px; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .btn-p { background: var(--primary); color: white; }
        .btn-p:hover { background: var(--secondary); transform: translateY(-1px); }
        .btn-s { background: #f0f2f5; color: #444; }
        .btn-danger { background: var(--danger); color: white; }

        /* ë§ˆí¬ë‹¤ìš´/ë‚˜ë¬´ìœ„í‚¤ ìŠ¤íƒ€ì¼ */
        .post-body { font-size: 16px; line-height: 1.8; color: #333; padding: 20px 0; border-top: 1px solid #f0f0f0; }
        .post-body h1 { border-bottom: 2px solid #f0f0f0; margin: 25px 0 15px; padding-bottom: 8px; font-size: 1.5em; }
        .post-body strong { font-weight: 800; color: #000; }
        .post-body del { color: #aaa; text-decoration: line-through; }
        .post-body blockquote { border-left: 5px solid var(--primary); background: #f8f9ff; padding: 15px; margin: 15px 0; }
        
        /* íšŒì›/ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ */
        .item-row { padding: 15px; border-bottom: 1px solid #f5f7f9; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
        .item-row:hover { background: #fcfdfe; }
        .item-row:last-child { border-bottom: none; }

        /* ëª¨ë‹¬ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal.active { display: flex; }
        .modal-content { background: white; width: 90%; max-width: 550px; padding: 35px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        input, textarea { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; margin-top: 8px; font-size: 14px; }
        textarea { resize: none; font-family: inherit; }

        .home-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 650px) { .home-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="logo" onclick="goHome()">ğŸš€ CODING MASTER</div>
        <div class="search-bar">
            <input type="text" id="globalSearch" placeholder="ë¬´ì—‡ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?" onkeypress="handleSearch(event)">
        </div>
        <div id="authArea">
            <button class="btn btn-s" onclick="openModal('loginModal')" style="margin-right:8px;">ë¡œê·¸ì¸</button>
            <button class="btn btn-p" onclick="openModal('joinModal')">íšŒì›ê°€ì…</button>
        </div>
        <div id="userArea" style="display:none; align-items:center; gap:12px;">
            <span id="welcomeMsg" style="font-weight:800; font-size:14px; color:var(--primary);"></span>
            <button class="btn btn-s" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
    <nav class="nav-menu" id="mainNav">
        <div class="nav-item active" id="menu-home" onclick="goHome()">í™ˆ</div>
        <div class="nav-item" id="menu-notice" onclick="showBoard('notice')">ê³µì§€ì‚¬í•­</div>
        <div class="nav-item" id="menu-free" onclick="showBoard('free')">ììœ ê²Œì‹œíŒ</div>
        <div class="nav-item" id="menu-album" onclick="showBoard('album')">ê°¤ëŸ¬ë¦¬</div>
        <div class="nav-item" id="menu-admin" onclick="showPage('admin')" style="display:none; color:var(--danger)">ğŸ‘‘ ê´€ë¦¬ì½˜ì†”</div>
    </nav>
</header>

<div class="main-container">
    <div class="content-left">
        <div id="page-home" class="page active">
            <div id="ad-container" class="ad-banner">
                </div>

            <div class="home-grid">
                <div class="card">
                    <h3 style="display:flex; align-items:center; gap:8px;">ğŸ“¢ ìµœê·¼ ê³µì§€</h3>
                    <div id="home-notice-list" style="margin-top:15px;"></div>
                </div>
                <div class="card">
                    <h3 style="display:flex; align-items:center; gap:8px; color:var(--accent);">â­ ìš´ì˜ì§„ í”½</h3>
                    <div id="home-pick-list" style="margin-top:15px;"></div>
                </div>
            </div>
            
            <div class="card">
                <h3>ğŸ†• ìµœê·¼ ì˜¬ë¼ì˜¨ ê¸€</h3>
                <div id="home-free-list" style="margin-top:15px;"></div>
            </div>
        </div>

        <div id="page-board" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 id="board-title" style="font-size:24px; font-weight:800;">ê²Œì‹œíŒ</h2>
                <button class="btn btn-p" id="writeBtn" onclick="openWriteModal()">ê¸€ì“°ê¸°</button>
            </div>
            <div id="post-list" class="card" style="padding:10px;"></div>
        </div>

        <div id="page-detail" class="page">
            <div class="card">
                <div id="post-header"></div>
                <div id="post-body" class="post-body"></div>
                <div id="admin-tools" style="display:none; margin-top:25px; padding-top:20px; border-top:2px dashed #eee; gap:10px;">
                    <span style="font-weight:bold; color:var(--danger);">ê´€ë¦¬ì ì „ìš©: </span>
                    <button class="btn btn-s" onclick="togglePick()">ì¶”ì²œê¸€ í† ê¸€</button>
                    <button class="btn btn-danger" onclick="deletePost()">ê²Œì‹œê¸€ ì‚­ì œ</button>
                </div>
            </div>
            <div class="card">
                <h4>ëŒ“ê¸€ <span id="cmt-count" style="color:var(--primary);">0</span></h4>
                <div id="comment-list" style="margin:20px 0;"></div>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...">
                    <button class="btn btn-p" onclick="addComment()">ë“±ë¡</button>
                </div>
            </div>
            <button class="btn btn-s" onclick="goBackList()">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="page-admin" class="page">
            <h2 style="margin-bottom:25px;">ğŸ‘‘ ì»¤ë®¤ë‹ˆí‹° ê´€ë¦¬ ì„¼í„°</h2>
            <div class="card">
                <h3>ğŸ“¢ ë°°ë„ˆ/ê´‘ê³  ê´€ë¦¬</h3>
                <div style="display:grid; gap:10px; margin-top:15px;">
                    <input type="text" id="adInpTitle" placeholder="ê´‘ê³  ì œëª©">
                    <input type="text" id="adInpText" placeholder="ê´‘ê³  ì„¤ëª…/ë¬¸êµ¬">
                    <button class="btn btn-p" onclick="addAd()">ê´‘ê³  ê²Œì‹œ</button>
                </div>
                <div id="admin-ad-list" style="margin-top:20px;"></div>
            </div>
            <div class="card">
                <h3>ğŸ‘¤ íšŒì› ëª©ë¡ ë° ê¶Œí•œ</h3>
                <div id="admin-user-list" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <h4>ğŸ“ˆ ì»¤ë®¤ë‹ˆí‹° í†µê³„</h4>
            <div style="margin-top:10px; font-size:14px; display:grid; gap:8px;">
                <div style="display:flex; justify-content:space-between;"><span>ì „ì²´ ê²Œì‹œê¸€</span><b id="stat-posts">0</b></div>
                <div style="display:flex; justify-content:space-between;"><span>ì „ì²´ íšŒì›</span><b id="stat-users">0</b></div>
            </div>
        </div>
        <div class="card" id="myInfoCard" style="display:none; background: #f8f9ff; border: 1px solid var(--primary);">
            <h4 id="myName">ì‚¬ìš©ìë‹˜</h4>
            <p id="myRole" style="font-size:12px; color:var(--primary); font-weight:700;"></p>
            <div style="margin-top:10px; font-size:12px; color:#666;">í™˜ì˜í•©ë‹ˆë‹¤!</div>
        </div>
    </div>
</div>

<div class="modal" id="loginModal">
    <div class="modal-content">
        <h2 style="margin-bottom:20px;">ë¡œê·¸ì¸</h2>
        <input type="text" id="loginId" placeholder="ë‹‰ë„¤ì„">
        <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleLogin()">ì‹œì‘í•˜ê¸°</button>
        <button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('loginModal')">ë‹«ê¸°</button>
    </div>
</div>

<div class="modal" id="joinModal">
    <div class="modal-content">
        <h2 style="margin-bottom:20px;">íšŒì›ê°€ì…</h2>
        <input type="text" id="joinId" placeholder="ë‹‰ë„¤ì„">
        <input type="password" id="joinPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleJoin()">ê°€ì… ì™„ë£Œ</button>
        <button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('joinModal')">ì·¨ì†Œ</button>
    </div>
</div>

<div class="modal" id="writeModal">
    <div class="modal-content" style="max-width:700px;">
        <h2 id="writeModalTitle">ê¸€ ì‘ì„±</h2>
        <input type="text" id="writeTitle" placeholder="ì œëª©">
        <textarea id="writeContent" style="height:350px;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”... (ë§ˆí¬ë‹¤ìš´ ë° ë‚˜ë¬´ìœ„í‚¤ ë¬¸ë²• ì§€ì›)"></textarea>
        <div style="margin-top:15px;">
            <label style="font-size:12px; font-weight:700;">ì²¨ë¶€íŒŒì¼</label>
            <input type="file" id="fileInput" onchange="handleFilePreview()">
            <img id="writeImgPreview" style="display:none; max-width:100%; margin-top:15px; border-radius:12px; border:1px solid #eee;">
        </div>
        <button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleSavePost()">ì‘ì„± ì™„ë£Œ</button>
        <button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('writeModal')">ì·¨ì†Œ</button>
    </div>
</div>

<script>
    /* --- í†µí•© ë°ì´í„°ë² ì´ìŠ¤ ë¡œì§ --- */
    let db = {
        users: [{ id: 'ê³„ì†ë°˜ë³µ', pw: 'akdhs', role: 'owner' }],
        posts: [],
        comments: [],
        ads: [{ title: 'ì½”ë”© ë§ˆìŠ¤í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤', text: 'ì§€ê¸ˆ ë°”ë¡œ ììœ ê²Œì‹œíŒì— ì²« ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!' }],
        currentBoard: 'free',
        currentUser: null,
        viewingPostId: null,
        lastBoard: 'free'
    };

    function init() {
        const saved = localStorage.getItem('coding_master_vFinal');
        if (saved) db = JSON.parse(saved);
        updateAuthUI();
        goHome();
    }
    function save() {
        localStorage.setItem('coding_master_vFinal', JSON.stringify(db));
        updateStats();
    }

    /* --- ë§ˆí¬ë‹¤ìš´ & ë‚˜ë¬´ìœ„í‚¤ íŒŒì„œ --- */
    function parse(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") // XSS ë°©ì§€
            .replace(/'''(.+?)'''/g, "<strong>$1</strong>") // ë‚˜ë¬´ìœ„í‚¤ êµµê²Œ
            .replace(/''(.+?)''/g, "<i>$1</i>") // ë‚˜ë¬´ìœ„í‚¤ ê¸°ìš¸ì„
            .replace(/~~(.+?)~~/g, "<del>$1</del>") // ì·¨ì†Œì„ 
            .replace(/^# (.+)$/gm, "<h1>$1</h1>") // ë§ˆí¬ë‹¤ìš´ ì œëª©
            .replace(/^## (.+)$/gm, "<h2>$1</h2>")
            .replace(/^> (.+)$/gm, "<blockquote>$1</blockquote>") // ì¸ìš©ë¬¸
            .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>") // ë§ˆí¬ë‹¤ìš´ êµµê²Œ
            .replace(/\n/g, "<br>");
    }

    /* --- ë„¤ë¹„ê²Œì´ì…˜ & í™”ë©´ ì „í™˜ --- */
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const menu = document.getElementById('menu-' + pageId);
        if (menu) menu.classList.add('active');

        if (pageId === 'admin') renderAdmin();
        window.scrollTo(0,0);
    }

    function goHome() {
        showPage('home');
        renderHome();
    }

    function showBoard(boardId) {
        db.currentBoard = boardId;
        db.lastBoard = boardId;
        showPage('board');
        const titles = { notice:'ğŸ“¢ ê³µì§€ì‚¬í•­', free:'ğŸ’¬ ììœ ê²Œì‹œíŒ', album:'ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬', search:'ğŸ” ê²€ìƒ‰ê²°ê³¼' };
        document.getElementById('board-title').innerText = titles[boardId] || 'ê²Œì‹œíŒ';
        renderPostList();
    }

    /* --- í™ˆ í™”ë©´ ë Œë”ë§ --- */
    function renderHome() {
        // ê³µì§€ ë¦¬ìŠ¤íŠ¸
        const notices = db.posts.filter(p => p.board === 'notice').slice(-5).reverse();
        document.getElementById('home-notice-list').innerHTML = notices.map(p => 
            `<div class="item-row" onclick="viewPost(${p.id})"><span>${p.title}</span><small>${p.date.split(' ')[0]}</small></div>`
        ).join('') || '<p style="font-size:12px; color:#999;">ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';

        // ì¶”ì²œê¸€ ë¦¬ìŠ¤íŠ¸
        const picks = db.posts.filter(p => p.isPick).slice(-5).reverse();
        document.getElementById('home-pick-list').innerHTML = picks.map(p => 
            `<div class="item-row" onclick="viewPost(${p.id})"><span>${p.title}</span><small>${p.author}</small></div>`
        ).join('') || '<p style="font-size:12px; color:#999;">ì¶”ì²œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        // ìµœê·¼ ììœ ê¸€
        const frees = db.posts.filter(p => p.board === 'free').slice(-5).reverse();
        document.getElementById('home-free-list').innerHTML = frees.map(p => 
            `<div class="item-row" onclick="viewPost(${p.id})"><span>${p.title}</span><small>${p.date.split(' ')[1]}</small></div>`
        ).join('') || '<p style="font-size:12px; color:#999;">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

        // ê´‘ê³  ë°°ë„ˆ
        const adBox = document.getElementById('ad-container');
        if (db.ads.length > 0) {
            const lastAd = db.ads[db.ads.length - 1];
            adBox.innerHTML = `<div class="ad-item"><h2>${lastAd.title}</h2><p>${lastAd.text}</p></div>`;
            adBox.style.display = 'block';
        } else {
            adBox.style.display = 'none';
        }
    }

    /* --- ê²Œì‹œê¸€ ìƒì„¸ ë° ê´€ë¦¬ --- */
    function viewPost(id) {
        const post = db.posts.find(p => p.id === id);
        if (!post) return;
        db.viewingPostId = id;
        showPage('detail');
        
        post.views = (post.views || 0) + 1;
        save();

        document.getElementById('post-header').innerHTML = `
            <div style="margin-bottom:15px;"><span style="color:var(--primary); font-weight:700;">[${post.board.toUpperCase()}]</span></div>
            <h1 style="font-size:28px; font-weight:800; line-height:1.2;">${post.isPick ? 'â­ ' : ''}${post.title}</h1>
            <div style="margin-top:15px; color:#888; font-size:13px; display:flex; gap:15px;">
                <span><b>${post.author}</b></span> <span>${post.date}</span> <span>ì¡°íšŒ ${post.views}</span>
            </div>
        `;
        document.getElementById('post-body').innerHTML = parse(post.content);
        if (post.file) {
            document.getElementById('post-body').innerHTML += `<img src="${post.file}" style="max-width:100%; border-radius:15px; margin-top:20px;">`;
        }

        // ê´€ë¦¬ì ë„êµ¬ ë…¸ì¶œ ì—¬ë¶€
        const tools = document.getElementById('admin-tools');
        if (db.currentUser && (db.currentUser.role === 'owner' || db.currentUser.role === 'admin')) {
            tools.style.display = 'flex';
        } else {
            tools.style.display = 'none';
        }

        renderComments();
    }

    function togglePick() {
        const post = db.posts.find(p => p.id === db.viewingPostId);
        post.isPick = !post.isPick;
        save();
        alert(post.isPick ? 'ì¶”ì²œê¸€ë¡œ ë“±ë¡!' : 'ì¶”ì²œ í•´ì œ!');
        viewPost(post.id);
    }

    function deletePost() {
        if (!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) return;
        db.posts = db.posts.filter(p => p.id !== db.viewingPostId);
        db.comments = db.comments.filter(c => c.postId !== db.viewingPostId);
        save();
        showBoard(db.lastBoard);
    }

    /* --- ê²€ìƒ‰ --- */
    function handleSearch(e) {
        if (e.key === 'Enter') {
            const k = e.target.value.trim().toLowerCase();
            if (!k) return;
            const res = db.posts.filter(p => p.title.toLowerCase().includes(k) || p.content.toLowerCase().includes(k));
            db.currentBoard = 'search';
            showPage('board');
            document.getElementById('board-title').innerText = `ğŸ” "${k}" ê²€ìƒ‰ ê²°ê³¼`;
            renderCustomList(res);
            e.target.value = '';
        }
    }

    /* --- ê¸€ì“°ê¸° --- */
    let tempImg = null;
    function handleFilePreview() {
        const file = document.getElementById('fileInput').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            tempImg = reader.result;
            const prev = document.getElementById('writeImgPreview');
            prev.src = tempImg;
            prev.style.display = 'block';
        };
        if (file) reader.readAsDataURL(file);
    }

    function openWriteModal() {
        if (!db.currentUser) return alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”.');
        if (db.currentBoard === 'notice' && db.currentUser.role !== 'owner') return alert('ê³µì§€ëŠ” ìš´ì˜ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        
        tempImg = null;
        document.getElementById('writeTitle').value = '';
        document.getElementById('writeContent').value = '';
        document.getElementById('writeImgPreview').style.display = 'none';
        document.getElementById('writeModalTitle').innerText = `[${db.currentBoard.toUpperCase()}] ìƒˆ ê¸€ ì“°ê¸°`;
        openModal('writeModal');
    }

    function handleSavePost() {
        const t = document.getElementById('writeTitle').value.trim();
        const c = document.getElementById('writeContent').value.trim();
        if (!t || !c) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');

        db.posts.push({
            id: Date.now(),
            board: db.currentBoard === 'search' ? 'free' : db.currentBoard,
            title: t, content: c,
            author: db.currentUser.id,
            date: new Date().toLocaleString(),
            file: tempImg,
            views: 0, isPick: false
        });
        save();
        closeModal('writeModal');
        showBoard(db.currentBoard === 'search' ? 'free' : db.currentBoard);
    }

    /* --- ëŒ“ê¸€ --- */
    function addComment() {
        if (!db.currentUser) return alert('ë¡œê·¸ì¸ í•˜ì„¸ìš”.');
        const inp = document.getElementById('comment-input');
        if (!inp.value.trim()) return;
        db.comments.push({ postId: db.viewingPostId, author: db.currentUser.id, text: inp.value, date: new Date().toLocaleTimeString() });
        inp.value = '';
        save();
        renderComments();
    }

    function renderComments() {
        const cmts = db.comments.filter(c => c.postId === db.viewingPostId);
        document.getElementById('cmt-count').innerText = cmts.length;
        document.getElementById('comment-list').innerHTML = cmts.map(c => `
            <div style="padding:12px; background:#f8f9fa; border-radius:10px; margin-bottom:8px; font-size:14px;">
                <b>${c.author}</b> <span style="font-size:11px; color:#aaa; margin-left:8px;">${c.date}</span>
                <div style="margin-top:5px;">${c.text}</div>
            </div>
        `).join('') || '<p style="color:#999; font-size:13px;">ì²« ëŒ“ê¸€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</p>';
    }

    /* --- ìœ í‹¸ë¦¬í‹° ë° ë Œë”ë§ --- */
    function renderPostList() {
        const filtered = db.posts.filter(p => p.board === db.currentBoard).reverse();
        renderCustomList(filtered);
    }

    function renderCustomList(data) {
        const list = document.getElementById('post-list');
        list.innerHTML = data.map(p => `
            <div class="item-row" onclick="viewPost(${p.id})">
                <div>
                    <div style="font-weight:700; font-size:15px;">${p.isPick?'â­ ':''}${p.title} ${p.file?'ğŸ“':''}</div>
                    <div style="font-size:12px; color:#999; margin-top:4px;">${p.author} | ${p.date.split(' ')[0]}</div>
                </div>
                <div style="color:#aaa; font-size:12px;">ğŸ‘ï¸ ${p.views || 0}</div>
            </div>
        `).join('') || '<p style="padding:40px; text-align:center; color:#999;">ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    }

    function handleLogin() {
        const id = document.getElementById('loginId').value.trim();
        const pw = document.getElementById('loginPw').value.trim();
        const u = db.users.find(x => x.id === id && x.pw === pw);
        if (!u) return alert('íšŒì› ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        db.currentUser = u;
        updateAuthUI();
        closeModal('loginModal');
        alert(id + 'ë‹˜, ë°˜ê°‘ìŠµë‹ˆë‹¤!');
        document.getElementById('loginId').value = '';
        document.getElementById('loginPw').value = '';
    }

    function handleJoin() {
        const id = document.getElementById('joinId').value.trim();
        const pw = document.getElementById('joinPw').value.trim();
        if (!id || !pw) return;
        if (db.users.find(x => x.id === id)) return alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë¦„ì…ë‹ˆë‹¤.');
        db.users.push({ id, pw, role: 'member' });
        save();
        alert('ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
        closeModal('joinModal');
        document.getElementById('joinId').value = '';
        document.getElementById('joinPw').value = '';
    }

    function logout() { db.currentUser = null; updateAuthUI(); goHome(); }

    function updateAuthUI() {
        const auth = document.getElementById('authArea');
        const user = document.getElementById('userArea');
        const adminM = document.getElementById('menu-admin');
        const info = document.getElementById('myInfoCard');

        if (db.currentUser) {
            auth.style.display = 'none'; user.style.display = 'flex';
            document.getElementById('welcomeMsg').innerText = db.currentUser.id + 'ë‹˜';
            if (db.currentUser.role === 'owner' || db.currentUser.role === 'admin') adminM.style.display = 'block';
            else adminM.style.display = 'none';
            info.style.display = 'block';
            document.getElementById('myName').innerText = db.currentUser.id + 'ë‹˜';
            document.getElementById('myRole').innerText = db.currentUser.role === 'owner' ? 'ìµœê³ ìš´ì˜ì' : 'ì •íšŒì›';
        } else {
            auth.style.display = 'flex'; user.style.display = 'none';
            adminM.style.display = 'none'; info.style.display = 'none';
        }
        updateStats();
    }

    function updateStats() {
        document.getElementById('stat-posts').innerText = db.posts.length;
        document.getElementById('stat-users').innerText = db.users.length;
    }

    function renderAdmin() {
        const uList = document.getElementById('admin-user-list');
        uList.innerHTML = db.users.map(u => u.role === 'owner' ? '' : `
            <div class="item-row">
                <span><b>${u.id}</b> (${u.role})</span>
                <button class="btn btn-s" style="padding:5px 10px;" onclick="kickUser('${u.id}')">ì¶”ë°©</button>
            </div>
        `).join('');

        const aList = document.getElementById('admin-ad-list');
        aList.innerHTML = db.ads.map((a, i) => `
            <div class="item-row">
                <span>${a.title}</span>
                <button class="btn btn-s" onclick="db.ads.splice(${i},1);save();renderAdmin();">ì‚­ì œ</button>
            </div>
        `).join('');
    }

    function addAd() {
        const t = document.getElementById('adInpTitle').value;
        const x = document.getElementById('adInpText').value;
        if (!t) return;
        db.ads.push({ title: t, text: x });
        save(); renderAdmin(); alert('ë°°ë„ˆê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('adInpTitle').value = '';
        document.getElementById('adInpText').value = '';
    }

    function kickUser(id) {
        if (!confirm('ì •ë§ ì¶”ë°©í• ê¹Œìš”?')) return;
        db.users = db.users.filter(u => u.id !== id);
        save(); renderAdmin();
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function goBackList() { showBoard(db.lastBoard); }

    window.onload = init;
</script>

</body>

</html>
