<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë”© ë§ˆìŠ¤í„° </title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #4f46e5; --secondary: #7c3aed; --bg: #f3f4f6; --text: #1f2937; --danger: #ef4444; --card: #ffffff; --tag: #dbeafe; --tag-text: #1e40af; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; }
        
        header { background: white; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .header-top { max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; gap: 20px; }
        .logo { font-size: 26px; font-weight: 900; color: var(--primary); cursor: pointer; letter-spacing: -1.5px; }
        .search-bar { flex: 1; max-width: 450px; }
        .search-bar input { width: 100%; padding: 12px 20px; border-radius: 30px; border: 2px solid #f3f4f6; background: #f9fafb; outline: none; transition: 0.2s; }
        .search-bar input:focus { border-color: var(--primary); background: white; }

        .nav-menu { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; gap: 20px; overflow-x: auto; }
        .nav-item { padding: 15px 5px; cursor: pointer; font-size: 15px; font-weight: 700; color: #6b7280; border-bottom: 3px solid transparent; white-space: nowrap; }
        .nav-item.active { color: var(--primary); border-bottom-color: var(--primary); }

        .main-container { max-width: 1200px; margin: 30px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 300px; gap: 30px; }
        @media (max-width: 950px) { .main-container { grid-template-columns: 1fr; } }

        .page { display: none; }
        .page.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: 20px; padding: 25px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); margin-bottom: 25px; }
        .btn { padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; transition: 0.2s; font-size: 14px; }
        .btn-p { background: var(--primary); color: white; }
        .btn-s { background: #f3f4f6; color: #4b5563; }
        .btn-danger { background: var(--danger); color: white; }

        .item-row { padding: 20px; border-bottom: 1px solid #f3f4f6; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 12px; transition: 0.2s; }
        .item-row:hover { background: #f9fafb; transform: scale(1.01); }
        
        .tag { display: inline-block; padding: 3px 12px; background: var(--tag); color: var(--tag-text); border-radius: 20px; font-size: 12px; margin-right: 6px; font-weight: 600; }
        .comment-item { background: #f9fafb; padding: 15px; border-radius: 15px; margin-top: 10px; font-size: 14px; border: 1px solid #eee; }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; align-items:center; justify-content:center; backdrop-filter: blur(5px); }
        .modal.active { display: flex; }
        .modal-content { background:white; padding:40px; border-radius:24px; width:95%; max-width:550px; }
        input, textarea { width:100%; padding:14px; margin-top:12px; border: 2px solid #f3f4f6; border-radius:12px; outline:none; font-size: 15px; }
        input:focus, textarea:focus { border-color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="logo" onclick="goHome()">ğŸš€ MASTER PIECE</div>
        <div class="search-bar">
            <input type="text" id="globalSearch" placeholder="ì œëª© ë˜ëŠ” #íƒœê·¸ ê²€ìƒ‰ í›„ ì—”í„°" onkeypress="handleSearch(event)">
        </div>
        <div id="authArea">
            <button class="btn btn-s" onclick="openModal('loginModal')">ë¡œê·¸ì¸</button>
            <button class="btn btn-p" onclick="openModal('joinModal')">íšŒì›ê°€ì…</button>
        </div>
        <div id="userArea" style="display:none; align-items:center; gap:12px;">
            <span id="welcomeMsg" style="font-weight:800; color:var(--primary);"></span>
            <button class="btn btn-s" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
    <nav class="nav-menu">
        <div class="nav-item active" id="menu-home" onclick="goHome()">í™ˆ</div>
        <div class="nav-item" id="menu-notice" onclick="showBoard('notice')">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
        <div class="nav-item" id="menu-free" onclick="showBoard('free')">ğŸ’¬ ììœ ê²Œì‹œíŒ</div>
        <div class="nav-item" id="menu-qna" onclick="showBoard('qna')">â“ ì§ˆë¬¸ë‹µë³€</div>
        <div class="nav-item" id="menu-news" onclick="showBoard('news')">ğŸ“° ITë‰´ìŠ¤</div>
        <div class="nav-item" id="menu-tip" onclick="showBoard('tip')">ğŸ’¡ ê¿€íŒ</div>
        <div class="nav-item" id="menu-inquiry" onclick="showPage('inquiry')">ğŸ“® 1:1ë¬¸ì˜</div>
        <div class="nav-item" id="menu-admin" onclick="showPage('admin')" style="display:none; color:var(--danger)">ğŸ‘‘ ê´€ë¦¬ë„êµ¬</div>
    </nav>
</header>

<div class="main-container">
    <div class="content-left">
        <div id="page-home" class="page active">
            <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color:white;">
                <h1>í™˜ì˜í•©ë‹ˆë‹¤, ìš´ì˜ìë‹˜!</h1>
                <p style="opacity:0.9;">ì˜¤ëŠ˜ë„ ë©‹ì§„ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="card">
                <h3>ğŸ”¥ ì‹¤ì‹œê°„ ì¸ê¸°ê¸€</h3>
                <div id="home-posts" style="margin-top:15px;"></div>
            </div>
        </div>

        <div id="page-board" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h2 id="board-title">ê²Œì‹œíŒ</h2>
                <button class="btn btn-p" id="writeBtn" onclick="openWriteModal()">ê¸€ì“°ê¸°</button>
            </div>
            <div id="post-list" class="card" style="padding:0;"></div>
        </div>

        <div id="page-detail" class="page">
            <div class="card">
                <div id="post-header"></div>
                <div id="post-tags" style="margin:10px 0;"></div>
                <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
                <div id="post-body" style="font-size:17px; min-height:100px;"></div>
                <div style="display:flex; gap:12px; margin-top:30px;">
                    <button class="btn btn-p" style="background:#fee2e2; color:#ef4444;" onclick="handleLike()">â¤ï¸ ì¢‹ì•„ìš” <span id="like-count">0</span></button>
                    <div id="admin-tools" style="display:none;">
                        <button class="btn btn-danger" onclick="deletePost()">ì‚­ì œí•˜ê¸°</button>
                    </div>
                </div>
                <div style="margin-top:40px;">
                    <h4>ëŒ“ê¸€ <span id="comment-count" style="color:var(--primary)">0</span></h4>
                    <div id="comment-list" style="margin:20px 0;"></div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="commentInp" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”.">
                        <button class="btn btn-p" onclick="saveComment()">ë“±ë¡</button>
                    </div>
                </div>
            </div>
            <button class="btn btn-s" onclick="goBackList()">ëª©ë¡ìœ¼ë¡œ</button>
        </div>

        <div id="page-inquiry" class="page">
            <div class="card">
                <h2>ğŸ“® ìš´ì˜ì 1:1 ë¬¸ì˜</h2>
                <p style="color:#6b7280; margin-bottom:20px;">ìš´ì˜ì('ê³„ì†ë°˜ë³µ')ë‹˜ê»˜ë§Œ ì „ë‹¬ë˜ëŠ” ë¹„ë°€ ë©”ì‹œì§€ì…ë‹ˆë‹¤.</p>
                <textarea id="inquiryContent" rows="8" placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
                <button class="btn btn-p" style="width:100%; margin-top:15px;" onclick="sendInquiry()">ë¬¸ì˜ ì ‘ìˆ˜</button>
            </div>
        </div>

        <div id="page-admin" class="page">
            <div class="card">
                <h2>ğŸ‘‘ ìš´ì˜ ê´€ë¦¬ ì„¼í„°</h2>
                <hr style="margin:20px 0;">
                <h3>ë°›ì€ ë¬¸ì˜ ë‚´ì—­</h3>
                <div id="admin-inquiry-list" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <h4>ğŸ“Š í˜„í™© ë°ì´í„°</h4>
            <div style="margin-top:15px; font-size:14px; display:flex; flex-direction:column; gap:8px;">
                <div style="display:flex; justify-content:space-between;"><span>ì´ ê²Œì‹œê¸€</span><b id="stat-posts">0</b></div>
                <div style="display:flex; justify-content:space-between;"><span>ê°€ì…ì</span><b id="stat-users">0</b></div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="loginModal"><div class="modal-content"><h2>ë¡œê·¸ì¸</h2><input type="text" id="loginId" placeholder="ì•„ì´ë””"><input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸"><button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleLogin()">ì‹œì‘í•˜ê¸°</button><button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('loginModal')">ë‹«ê¸°</button></div></div>
<div class="modal" id="joinModal"><div class="modal-content"><h2>íšŒì›ê°€ì…</h2><input type="text" id="joinId" placeholder="ì•„ì´ë””"><input type="password" id="joinPw" placeholder="ë¹„ë°€ë²ˆí˜¸"><button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleJoin()">ê°€ì… ì™„ë£Œ</button><button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('joinModal')">ì·¨ì†Œ</button></div></div>
<div class="modal" id="writeModal"><div class="modal-content"><h2>ê¸€ì“°ê¸°</h2><input type="text" id="writeTitle" placeholder="ì œëª©"><input type="text" id="writeTags" placeholder="íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„, ì˜ˆ: ìë°”, ì§ˆë¬¸, ê¿€íŒ)"><textarea id="writeContent" rows="10" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea><input type="file" id="fileInput" onchange="handleFilePreview()"><img id="writeImgPreview" style="display:none; max-width:100%; margin-top:15px; border-radius:15px;"><button class="btn btn-p" style="width:100%; margin-top:20px;" onclick="handleSavePost()">ì‘ì„± ì™„ë£Œ</button><button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="closeModal('writeModal')">ì·¨ì†Œ</button></div></div>

<script>
    // 1. Firebase ì„¤ì •
    const firebaseConfig = {
        apiKey: "AIzaSyBcxvsiEOyL1lZGVr1UE2gzzZ7HQX5YfbI",
        authDomain: "code-78890.firebaseapp.com",
        projectId: "code-78890",
        storageBucket: "code-78890.firebasestorage.app",
        messagingSenderId: "30317586652",
        appId: "1:30317586652:web:d1e6fa39c319029fb7ac19"
    };
    firebase.initializeApp(firebaseConfig);
    const fdb = firebase.firestore();

    // 2. ì „ì—­ ìƒíƒœ
    let db = {
        users: [], posts: [], 
        currentBoard: 'free', currentUser: null,
        viewingPostId: null, tempImg: null
    };

    // 3. ì•± êµ¬ë™ ë° ë¦¬ìŠ¤ë„ˆ
    function init() {
        fdb.collection("users").onSnapshot(s => {
            db.users = s.docs.map(d => d.data());
            document.getElementById('stat-users').innerText = db.users.length;
        });

        fdb.collection("posts").orderBy("id", "desc").onSnapshot(s => {
            db.posts = s.docs.map(d => ({fId: d.id, ...d.data()}));
            renderHome();
            renderPostList();
            document.getElementById('stat-posts').innerText = db.posts.length;
        });

        fdb.collection("inquiries").orderBy("date", "desc").onSnapshot(s => {
            const list = s.docs.map(d => d.data());
            document.getElementById('admin-inquiry-list').innerHTML = list.map(i => `
                <div class="comment-item"><b>${i.user}ë‹˜ì˜ ë¬¸ì˜</b> (${i.date})<br>${i.content}</div>
            `).join('') || 'ì ‘ìˆ˜ëœ ë¬¸ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.';
        });
    }

    // 4. ë‚´ë¹„ê²Œì´ì…˜
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    }

    function goHome() { showPage('home'); document.getElementById('menu-home').classList.add('active'); }

    function showBoard(boardId) {
        db.currentBoard = boardId;
        showPage('board');
        document.getElementById('menu-' + (boardId === 'search' ? 'free' : boardId)).classList.add('active');
        const labels = { notice:'ğŸ“¢ ê³µì§€ì‚¬í•­', free:'ğŸ’¬ ììœ ê²Œì‹œíŒ', qna:'â“ ì§ˆë¬¸ë‹µë³€', news:'ğŸ“° ITë‰´ìŠ¤', tip:'ğŸ’¡ ê¿€íŒ', search:'ğŸ” ê²€ìƒ‰ê²°ê³¼' };
        document.getElementById('board-title').innerText = labels[boardId];
        renderPostList();
    }

    // 5. ë¡œê·¸ì¸ (ë§ˆìŠ¤í„° ê³„ì •: ê³„ì†ë°˜ë³µ / akdhs)
    async function handleLogin() {
        const id = document.getElementById('loginId').value.trim();
        const pw = document.getElementById('loginPw').value.trim();

        // ìš´ì˜ì ê³„ì • íŠ¹ìˆ˜ ì²´í¬
        if(id === 'ê³„ì†ë°˜ë³µ' && pw === 'akdhs') {
            db.currentUser = { id: 'ê³„ì†ë°˜ë³µ', role: 'owner' };
            completeLogin('ê³„ì†ë°˜ë³µ(ë§ˆìŠ¤í„°)');
            return;
        }

        const user = db.users.find(u => u.id === id && u.pw === pw);
        if(user) {
            db.currentUser = user;
            completeLogin(id);
        } else { alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'); }
    }

    function completeLogin(name) {
        updateAuthUI();
        closeModal('loginModal');
        alert(name + 'ë‹˜ ë°˜ê°‘ìŠµë‹ˆë‹¤!');
    }

    async function handleJoin() {
        const id = document.getElementById('joinId').value.trim();
        const pw = document.getElementById('joinPw').value.trim();
        if(!id || !pw) return alert('ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
        if(id === 'ê³„ì†ë°˜ë³µ') return alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
        
        const check = await fdb.collection("users").where("id", "==", id).get();
        if(!check.empty) return alert('ì´ë¯¸ ê°€ì…ëœ ì•„ì´ë””ì…ë‹ˆë‹¤.');

        await fdb.collection("users").add({ id, pw, role: 'member' });
        alert('ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.');
        closeModal('joinModal');
    }

    function logout() { db.currentUser = null; updateAuthUI(); goHome(); }

    function updateAuthUI() {
        const isLogin = !!db.currentUser;
        document.getElementById('authArea').style.display = isLogin ? 'none' : 'flex';
        document.getElementById('userArea').style.display = isLogin ? 'flex' : 'none';
        if(isLogin) {
            document.getElementById('welcomeMsg').innerText = db.currentUser.id;
            document.getElementById('menu-admin').style.display = (db.currentUser.role === 'owner') ? 'block' : 'none';
        }
    }

    // 6. ê²Œì‹œê¸€ CRUD
    function createPostHtml(p) {
        const tags = (p.tags || []).map(t => `<span class="tag">#${t}</span>`).join('');
        return `
            <div class="item-row" onclick="viewPost('${p.fId}')">
                <div>
                    <span style="font-weight:800; font-size:16px;">${p.title}</span><br>
                    <div style="margin:6px 0;">${tags}</div>
                    <small style="color:#9ca3af;">${p.author} | ${p.date}</small>
                </div>
                <div style="text-align:right;">
                    <b style="color:var(--danger)">â¤ï¸ ${p.likes || 0}</b><br>
                    <small style="color:#d1d5db">ğŸ‘ï¸ ${p.views || 0}</small>
                </div>
            </div>`;
    }

    function renderPostList() {
        if(db.currentBoard === 'search') return;
        const filtered = db.posts.filter(p => p.board === db.currentBoard);
        document.getElementById('post-list').innerHTML = filtered.map(p => createPostHtml(p)).join('') || '<p style="padding:40px; text-align:center; color:#999;">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    }

    function renderHome() {
        const hot = [...db.posts].sort((a,b) => (b.likes || 0) - (a.likes || 0)).slice(0, 5);
        document.getElementById('home-posts').innerHTML = hot.map(p => createPostHtml(p)).join('');
    }

    function openWriteModal() {
        if(!db.currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        // ê³µì§€ì‚¬í•­ì€ 'ê³„ì†ë°˜ë³µ' ì „ìš©
        if(db.currentBoard === 'notice' && db.currentUser.id !== 'ê³„ì†ë°˜ë³µ') {
            return alert('ê³µì§€ì‚¬í•­ì€ ìš´ì˜ì(ê³„ì†ë°˜ë³µ)ë‹˜ë§Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
        openModal('writeModal');
    }

    async function handleSavePost() {
        const title = document.getElementById('writeTitle').value.trim();
        const content = document.getElementById('writeContent').value.trim();
        const tagInput = document.getElementById('writeTags').value.trim();
        if(!title || !content) return alert('ë‚´ìš©ì„ ì±„ì›Œì£¼ì„¸ìš”.');

        const tags = tagInput ? tagInput.split(',').map(t => t.trim()) : [];
        const postData = {
            id: Date.now(),
            board: db.currentBoard === 'search' ? 'free' : db.currentBoard,
            title, content, tags,
            author: db.currentUser.id,
            date: new Date().toLocaleDateString(),
            views: 0, likes: 0, file: db.tempImg
        };

        await fdb.collection("posts").add(postData);
        closeModal('writeModal');
        // ì´ˆê¸°í™”
        document.getElementById('writeTitle').value = '';
        document.getElementById('writeContent').value = '';
        document.getElementById('writeTags').value = '';
        db.tempImg = null;
    }

    // 7. ìƒì„¸ ë³´ê¸° & ì¢‹ì•„ìš” & ëŒ“ê¸€
    function viewPost(fId) {
        const post = db.posts.find(p => p.fId === fId);
        if(!post) return;
        db.viewingPostId = fId;
        showPage('detail');
        
        document.getElementById('post-header').innerHTML = `<h1>${post.title}</h1><p style="color:#888; margin-top:5px;">${post.author} | ${post.date} | ì¡°íšŒìˆ˜ ${post.views || 0}</p>`;
        document.getElementById('post-tags').innerHTML = (post.tags || []).map(t => `<span class="tag">#${t}</span>`).join('');
        document.getElementById('post-body').innerHTML = `<p style="white-space:pre-wrap;">${post.content}</p>` + (post.file ? `<img src="${post.file}" style="max-width:100%; margin-top:20px; border-radius:15px;">` : '');
        document.getElementById('like-count').innerText = post.likes || 0;
        
        // ìš´ì˜ìì´ê±°ë‚˜ ë³¸ì¸ì´ë©´ ì‚­ì œ ë²„íŠ¼
        const isMaster = db.currentUser && (db.currentUser.id === 'ê³„ì†ë°˜ë³µ' || db.currentUser.id === post.author);
        document.getElementById('admin-tools').style.display = isMaster ? 'block' : 'none';

        fdb.collection("posts").doc(fId).update({ views: (post.views || 0) + 1 });
        loadComments(fId);
    }

    async function handleLike() {
        if(!db.currentUser) return alert('ì¢‹ì•„ìš”ëŠ” ë¡œê·¸ì¸ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        const post = db.posts.find(p => p.fId === db.viewingPostId);
        await fdb.collection("posts").doc(db.viewingPostId).update({ likes: (post.likes || 0) + 1 });
        document.getElementById('like-count').innerText = (post.likes || 0) + 1;
    }

    async function saveComment() {
        if(!db.currentUser) return alert('ëŒ“ê¸€ì€ ë¡œê·¸ì¸ í›„ ì‘ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        const content = document.getElementById('commentInp').value.trim();
        if(!content) return;
        await fdb.collection("comments").add({ postId: db.viewingPostId, user: db.currentUser.id, content, date: new Date().toLocaleString() });
        document.getElementById('commentInp').value = '';
        loadComments(db.viewingPostId);
    }

    async function loadComments(postId) {
        const s = await fdb.collection("comments").where("postId", "==", postId).get();
        const list = s.docs.map(d => d.data());
        document.getElementById('comment-count').innerText = list.length;
        document.getElementById('comment-list').innerHTML = list.map(c => `<div class="comment-item"><b>${c.user}</b> <small style="float:right; color:#bbb;">${c.date}</small><br>${c.content}</div>`).join('');
    }

    function deletePost() {
        if(confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) fdb.collection("posts").doc(db.viewingPostId).delete().then(() => showBoard(db.currentBoard));
    }

    // 8. ê¸°íƒ€ ê¸°ëŠ¥ (ê²€ìƒ‰, ë¬¸ì˜)
    function handleSearch(e) {
        if(e.key === 'Enter') {
            const query = e.target.value.toLowerCase().trim();
            if(!query) return;
            const res = db.posts.filter(p => p.title.toLowerCase().includes(query) || (p.tags && p.tags.some(t => t.toLowerCase().includes(query))));
            db.currentBoard = 'search';
            showBoard('search');
            document.getElementById('post-list').innerHTML = res.map(p => createPostHtml(p)).join('') || '<p style="padding:40px; text-align:center;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            e.target.value = '';
        }
    }

    async function sendInquiry() {
        if(!db.currentUser) return alert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        const content = document.getElementById('inquiryContent').value.trim();
        if(!content) return;
        await fdb.collection("inquiries").add({ user: db.currentUser.id, content, date: new Date().toLocaleString() });
        alert('ë¬¸ì˜ê°€ ìš´ì˜ìë‹˜ê»˜ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('inquiryContent').value = '';
        goHome();
    }

    function handleFilePreview() {
        const file = document.getElementById('fileInput').files[0];
        const reader = new FileReader();
        reader.onloadend = () => { db.tempImg = reader.result; document.getElementById('writeImgPreview').src = reader.result; document.getElementById('writeImgPreview').style.display = 'block'; };
        if(file) reader.readAsDataURL(file);
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function goBackList() { showBoard(db.currentBoard); }

    window.onload = init;
</script>
</body>
</html>
